import{j as e,u as Q,r as i,a as j,L as S,S as T,z as o,t as r}from"./index-CN1hkNaS.js";import{u as w}from"./useQuery-C37Zs1O9.js";import{C as K}from"./ConfirmModal-Bw0MBfm6.js";import{S as P,C as f}from"./SimpleLayout-BIrQhjs0.js";import{E as I}from"./EmptyState-KcKSc6Kb.js";function U({open:u,title:s,onClose:n,children:m}){return u?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white p-6 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-ink",children:s}),e.jsx("button",{onClick:n,className:"text-sm text-slate",children:"Close"})]}),e.jsx("div",{className:"mt-4",children:m})]})}):null}function _(){const u=Q(),[s,n]=i.useState(null),[m,D]=i.useState(null),[y,C]=i.useState(""),[x,F]=i.useState(null),[k,q]=i.useState(""),[g,L]=i.useState(null),[h,A]=i.useState(null),p=w({queryKey:["teacher","pending-students"],queryFn:async()=>(await r.pendingStudents()).data}),c=w({queryKey:["teacher","documents"],queryFn:async()=>(await r.listDocuments()).data}),d=w({queryKey:["teacher","document",h],queryFn:async()=>(await r.getDocument(h)).data,enabled:!!h}),M=j({mutationFn:async()=>{if(!(!s||s.type==="delete-doc"))return s.type==="approve"?r.approveStudent(s.userId):r.rejectStudent(s.userId)},onSuccess:()=>{o.success("Student updated"),u.invalidateQueries({queryKey:["teacher","pending-students"]})},onError:t=>{var a,l;return o.error(((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||"Action failed")},onSettled:()=>n(null)}),N=j({mutationFn:async()=>{if(!m)throw new Error("File missing");const t=new FormData;return t.append("file",m),y&&t.append("title",y),r.uploadDocument(t)},onSuccess:()=>{o.success("Document uploaded"),D(null),C(""),u.invalidateQueries({queryKey:["teacher","documents"]})},onError:t=>{var a,l;return o.error(((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||"Upload failed")}}),E=j({mutationFn:async()=>{if(!(!s||s.type!=="delete-doc"))return r.deleteDocument(s.documentId)},onSuccess:()=>{o.success("Document deleted"),u.invalidateQueries({queryKey:["teacher","documents"]})},onError:t=>{var a,l;return o.error(((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||"Delete failed")},onSettled:()=>n(null)}),b=j({mutationFn:async()=>{if(!x)throw new Error("Select a document");return r.askDocument(x,k)},onSuccess:t=>L(t.data),onError:t=>{var a,l;return o.error(((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||"Ask failed")}}),v=i.useMemo(()=>(c.data||[]).find(t=>t.id===x)||null,[c.data,x]);return e.jsxs(P,{title:"Teacher Workspace",subtitle:"Manage approvals, documents, and AI insights.",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.1fr_1fr]",children:[e.jsxs(f,{title:"Pending Students",children:[p.isLoading&&e.jsx(S,{}),!p.isLoading&&(p.data||[]).length===0&&e.jsx(I,{title:"No pending students",description:"All assigned students are reviewed."}),(p.data||[]).length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"text-xs uppercase text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3",children:"Student"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Roll"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:(p.data||[]).map(t=>e.jsxs("tr",{className:"border-t border-slate-100",children:[e.jsxs("td",{className:"py-4",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:t.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[t.className||"-"," ",t.section||""]})]}),e.jsxs("td",{children:[e.jsx("p",{children:t.email}),e.jsx("p",{className:"text-xs text-slate-500",children:t.phone||"-"})]}),e.jsx("td",{children:t.rollNo}),e.jsx("td",{children:e.jsx(T,{status:t.status})}),e.jsx("td",{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>n({type:"approve",userId:t.userId}),className:"rounded-full bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-700",children:"Approve"}),e.jsx("button",{onClick:()=>n({type:"reject",userId:t.userId}),className:"rounded-full bg-rose-500/10 px-3 py-1 text-xs font-semibold text-rose-700",children:"Reject"})]})})]},t.userId))})]})})]}),e.jsxs(f,{title:"Upload Document",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"PDF or DOCX up to 20MB"}),e.jsxs("div",{className:"mt-4 grid gap-3",children:[e.jsx("input",{value:y,onChange:t=>C(t.target.value),placeholder:"Optional title",className:"rounded-xl border border-slate-200 px-4 py-2 text-sm"}),e.jsx("input",{type:"file",accept:".pdf,.docx",onChange:t=>{var a;return D(((a=t.target.files)==null?void 0:a[0])??null)},className:"text-sm"}),e.jsx("button",{onClick:()=>N.mutate(),className:"rounded-xl bg-indigo-600 px-4 py-2 text-sm font-semibold text-white",disabled:N.isPending||!m,children:N.isPending?"Uploading...":"Upload"})]})]})]}),e.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-[1.1fr_1fr]",children:[e.jsxs(f,{title:"Documents",children:[c.isLoading&&e.jsx(S,{}),!c.isLoading&&(c.data||[]).length===0&&e.jsx(I,{title:"No documents",description:"Upload a PDF or DOCX to start."}),(c.data||[]).length>0&&e.jsx("div",{className:"mt-2 space-y-3",children:(c.data||[]).map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-100 px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:t.title||t.fileName}),e.jsxs("p",{className:"text-xs text-slate-500",children:[new Date(t.createdAt).toLocaleDateString()," ? ",t.chunkCount," chunks"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>F(t.id),className:`rounded-full px-3 py-1 text-xs font-semibold ${x===t.id?"bg-indigo-600 text-white":"bg-slate-100 text-slate"}`,children:"Select"}),e.jsx("button",{onClick:()=>A(t.id),className:"rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate",children:"View"}),e.jsx("button",{onClick:()=>n({type:"delete-doc",documentId:t.id}),className:"rounded-full bg-rose-500/10 px-3 py-1 text-xs font-semibold text-rose-700",children:"Delete"})]})]},t.id))})]}),e.jsxs(f,{title:"Ask Document AI",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Select a document and ask a question."}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("div",{className:"rounded-2xl border border-slate-100 px-4 py-3 text-sm text-slate-600",children:v?v.title||v.fileName:"No document selected"}),e.jsx("textarea",{value:k,onChange:t=>q(t.target.value),rows:4,placeholder:"Ask about the document content...",className:"w-full rounded-2xl border border-slate-200 px-4 py-3 text-sm"}),e.jsx("button",{onClick:()=>b.mutate(),className:"rounded-xl bg-indigo-600 px-4 py-2 text-sm font-semibold text-white",disabled:!x||b.isPending,children:b.isPending?"Thinking...":"Ask AI"})]}),g&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"rounded-2xl bg-slate-50 px-4 py-3 text-sm text-slate-600",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Answer"}),e.jsx("p",{className:"mt-2 text-slate-700",children:g.answer})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Used Chunks"}),e.jsx("div",{className:"mt-2 space-y-2",children:g.usedChunks.map(t=>e.jsxs("div",{className:"rounded-2xl border border-slate-100 px-3 py-2 text-xs text-slate-600",children:[e.jsxs("span",{className:"font-semibold",children:["Chunk ",t.chunkIndex,":"]})," ",t.preview]},t.chunkIndex))})]})]})]})]}),e.jsx(K,{open:!!s,title:(s==null?void 0:s.type)==="delete-doc"?"Delete document":(s==null?void 0:s.type)==="approve"?"Approve student":"Reject student",description:(s==null?void 0:s.type)==="delete-doc"?"This will permanently delete the document and its chunks.":"This action will update the student status immediately.",confirmLabel:(s==null?void 0:s.type)==="delete-doc"?"Delete":(s==null?void 0:s.type)==="approve"?"Approve":"Reject",onClose:()=>n(null),onConfirm:()=>{s&&(s.type==="delete-doc"?E.mutate():M.mutate())}}),e.jsxs(U,{open:!!h,title:"Document Details",onClose:()=>A(null),children:[d.isLoading&&e.jsx(S,{}),d.data&&e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Title:"})," ",d.data.title||"-"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"File:"})," ",d.data.fileName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Type:"})," ",d.data.mimeType]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Size:"})," ",Math.round(d.data.fileSize/1024)," KB"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Chunks:"})," ",d.data.chunkCount]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Uploaded:"})," ",new Date(d.data.createdAt).toLocaleString()]})]})]})]})}export{_ as TeacherDashboard};
