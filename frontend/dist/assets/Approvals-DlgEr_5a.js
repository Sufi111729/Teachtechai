import{r as n,u as C,a as I,j as e,L as A,S as w,z as y}from"./index-CN1hkNaS.js";import{u as f}from"./useQuery-C37Zs1O9.js";import{A as q,a as r}from"./AdminLayout-Dtl-kDgA.js";import{R as E,D as L,P as R}from"./Pagination-DDH6wBrv.js";import{C as T}from"./ConfirmModal-Bw0MBfm6.js";import{E as M}from"./EmptyState-KcKSc6Kb.js";function K(){const[c,j]=n.useState(""),[u,x]=n.useState(1),[o,v]=n.useState(10),[s,l]=n.useState({open:!1,userId:null,action:null}),h=C(),i=f({queryKey:["admin","pending-teachers"],queryFn:async()=>(await r.pendingTeachers()).data,refetchInterval:15e3,refetchOnWindowFocus:!0}),d=f({queryKey:["admin","pending-students"],queryFn:async()=>(await r.pendingStudents()).data,refetchInterval:15e3,refetchOnWindowFocus:!0}),p=n.useMemo(()=>[...i.data||[],...d.data||[]].map(t=>({...t,type:t.teacherCode?"TEACHER":"STUDENT"})),[i.data,d.data]),g=n.useMemo(()=>{const t=c.toLowerCase();return p.filter(a=>[a.name,a.email].some(b=>b.toLowerCase().includes(t)))},[p,c]),N=Math.max(1,Math.ceil(g.length/o)),m=g.slice((u-1)*o,u*o),S=I({mutationFn:async()=>{if(!s.userId||!s.action)return;const t=p.find(a=>a.userId===s.userId);if(t)return t.type==="TEACHER"?s.action==="approve"?r.approveTeacher(s.userId):r.rejectTeacher(s.userId):s.action==="approve"?r.approveStudent(s.userId):r.rejectStudent(s.userId)},onSuccess:()=>{y.success("Action completed"),h.invalidateQueries({queryKey:["admin"]})},onError:()=>y.error("Action failed"),onSettled:()=>l({open:!1,userId:null,action:null})});return e.jsxs(q,{title:"Approvals",children:[e.jsxs("div",{className:"rounded-2xl bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Quick Approvals"}),e.jsx("div",{className:"ml-auto",children:e.jsx("input",{value:c,onChange:t=>j(t.target.value),placeholder:"Search by name or email",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm"})}),e.jsxs("button",{onClick:()=>h.invalidateQueries({queryKey:["admin"]}),className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-600",children:[e.jsx(E,{size:14}),"Refresh"]})]}),e.jsxs("div",{className:"mt-4",children:[(i.isLoading||d.isLoading)&&e.jsx(A,{}),!i.isLoading&&!d.isLoading&&m.length===0&&e.jsx(M,{title:"No pending requests",description:"All approvals are completed."}),m.length>0&&e.jsx(L,{headers:["Select","Name","Email","Type","Requested","Status","Actions"],children:m.map((t,a)=>e.jsxs("tr",{className:a%2===0?"bg-white":"bg-slate-50/40",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox"})}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-slate-900",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:t.email}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:t.type}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(w,{status:t.status})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l({open:!0,userId:t.userId,action:"approve"}),className:"rounded-full bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-700",children:"Approve"}),e.jsx("button",{onClick:()=>l({open:!0,userId:t.userId,action:"reject"}),className:"rounded-full bg-rose-500/10 px-3 py-1 text-xs font-semibold text-rose-700",children:"Reject"})]})})]},t.userId))})]}),e.jsx("div",{className:"mt-4",children:e.jsx(R,{page:u,totalPages:N,pageSize:o,onPageChange:x,onPageSizeChange:t=>{v(t),x(1)}})})]}),e.jsx(T,{open:s.open,title:s.action==="approve"?"Approve request":"Reject request",description:"This action will update the user status immediately.",confirmLabel:s.action==="approve"?"Approve":"Reject",onClose:()=>l({open:!1,userId:null,action:null}),onConfirm:()=>S.mutate()})]})}export{K as Approvals};
